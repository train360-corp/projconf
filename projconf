#!/usr/bin/env bash
set -euo pipefail

# Server-specific requirements
export PROJCONF_POSTGRES_PASSWORD=postgres
export PROJCONF_JWT_SECRET=super-secret-jwt-token-with-at-least-32-characters-long
export PROJCONF_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
export PROJCONF_SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU

export PROJCONF_SUPABASE_URL="${PROJCONF_SUPABASE_URL:-http://127.0.0.1:54321}"

echo "==> Building projconf..."
goreleaser release --clean --skip=validate --snapshot

echo "==> Running projconf..."
exec ./dist/projconf_darwin_arm64_v8.0/projconf "$@"